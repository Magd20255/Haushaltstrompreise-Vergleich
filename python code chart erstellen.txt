import pandas as pd
import matplotlib.pyplot as plt

# Einlesen der Daten
df = pd.read_excel("Strompreise.xlsx")

# Berechnung der Stromkosten für 300 kWh und deren Anteil am Einkommen
df["Stromkosten_300kWh"] = df["Preis in EUR (ct/KWh)"] * 300 / 100
df["Anteil_Monat"] = (df["Stromkosten_300kWh"] / df["Einkommen in EUR"]) * 100

# Reihenfolge der Länder manuell festlegen
reihenfolge = ["USA", "Deutschland", "India"]
df["Sortierung"] = pd.Categorical(df["Land"], categories=reihenfolge, ordered=True)
df = df.sort_values("Sortierung")

# Erstellen des Diagramms
fig, ax = plt.subplots(figsize=(10, 6))
farben = ['#66c2a5', '#1f78b4', '#fc8d62']  # Benutzerdefinierte Farben

# Zeichnen der Balken
bars = ax.bar(df["Land"], df["Anteil_Monat"], color=farben)

# Beschriftung der Balken mit Prozentwerten
for bar, value in zip(bars, df["Anteil_Monat"]):
    ax.text(bar.get_x() + bar.get_width()/2, value + 0.3, f"{value:.2f}%",
            ha='center', va='bottom', fontsize=10, fontweight='bold')

# Achseneinstellungen
ax.set_ylim(0, 20)
ax.set_ylabel("Anteil vom Einkommen (%)")
ax.set_title("Anteil der Stromkosten (300 kWh) am Monatseinkommen")
ax.grid(axis='y', linestyle='--', alpha=0.5)

# Seitlicher Text mit Durchschnittseinkommen
text = "Durchschnittliches Einkommen (monatlich):\n"
for land, einkommen in zip(df["Land"], df["Einkommen in EUR"]):
    text += f"{land}: {int(einkommen)} EUR\n"

# Hinzufügen des Textes im Diagramm
props = dict(boxstyle='round', facecolor='whitesmoke', edgecolor='gray')
ax.text(1.03, 0.5, text, transform=ax.transAxes, fontsize=10,
        verticalalignment='center', bbox=props)

# Speichern und Anzeigen der Grafik
plt.tight_layout()
plt.savefig("stromkosten_beschriftet_sortiert.png")
plt.show()